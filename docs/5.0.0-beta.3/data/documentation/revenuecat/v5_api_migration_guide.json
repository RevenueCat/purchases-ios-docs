{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/RevenueCat\/documentation\/RevenueCat\/V5_API_Migration_guide"},"metadata":{"title":"RevenueCat 4.x to 5.x Migration Guide","modules":[{"name":"RevenueCat"}],"role":"article","roleHeading":"Article"},"schemaVersion":{"patch":0,"major":0,"minor":3},"hierarchy":{"paths":[["doc:\/\/RevenueCat\/documentation\/RevenueCat"]]},"sections":[],"primaryContentSections":[{"content":[{"text":"StoreKit 2","type":"heading","level":2,"anchor":"StoreKit-2"},{"type":"paragraph","inlineContent":[{"text":"Version 5.0 of the RevenueCat SDK enables full StoreKit 2 flow on the SDK and the RevenueCat backend by default.","type":"text"}]},{"inlineContent":[{"type":"text","text":"We have been testing StoreKit 2 support in parallel to StoreKit 1 in our backend for a while and we believe it is ready for widespread use."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here‚Äôs some of the benefits you get with StoreKit 2:"}]},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"Better handling of a few specific edge cases which were unfixable with StoreKit 1:"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"No more ‚ÄúMissing receipt‚Äù errors in Sandbox that could result in failure restoring purchases or getting trial eligibility status ‚Äúunknown‚Äù.","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"No more ‚ÄúThe purchased product was missing in the receipt‚Äù error that could cause an invalid receipt error when making a purchase."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Future proofing:  StoreKit 1 APIs are being progressively deprecated by Apple, and new features are being added to StoreKit 2.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Faster processing time: More efficient and performant implementation of receipts validation. We have found that receipts validation can be ~200ms faster comparing to SK1 implementation for p95 of the requests."}]}]}],"type":"unorderedList"},{"type":"paragraph","inlineContent":[{"text":"In order to use StoreKit 2, you will need to configure your ","type":"text"},{"identifier":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration","isActive":true,"type":"reference"},{"text":" in the RevenueCat dashboard.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"The previously deprecated configuration option ","type":"text"},{"type":"codeVoice","code":".with(usesStoreKit2IfAvailable: true)"},{"text":" has been removed. Remove it from your configuration option to continue using StoreKit 2.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"The SDK will automatically use StoreKit 1 in the following versions where StoreKit 2 is not supported: on macOS 11 or earlier, iOS 14 or earlier, iPadOS 14 or earlier, tvOS 14 or earlier, or watchOS 7 or earlier.","type":"text"}]},{"inlineContent":[{"text":"If for any reason you need to always use StoreKit 1, it is possible to switch back using the following configuration API:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["Purchases.configure(with: .builder(withAPIKey: apiKey)","    .with(storeKitVersion: .storeKit1)","    .build()"],"type":"codeListing"},{"level":3,"text":"3rd Party Analytics SDKs","anchor":"3rd-Party-Analytics-SDKs","type":"heading"},{"inlineContent":[{"text":"If you are using any 3rd party analytics SDKs to automatically track in-app purchases, you need to be aware most of them do not completely support logging purchases made with StoreKit 2. This is the case for some popular SDKs like Facebook, Mixpanel, OneSignal, Segment or Firebase. For these services, we recommend you use our ","type":"text"},{"identifier":"https:\/\/www.revenuecat.com\/integrations\/","isActive":true,"type":"reference"},{"text":".","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"If you‚Äôre using the Firebase SDK, you‚Äôll need to follow ","type":"text"},{"identifier":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift","isActive":true,"type":"reference"},{"type":"text","text":" to log purchases made with StoreKit 2."}]},{"level":3,"type":"heading","text":"Observer Mode","anchor":"Observer-Mode"},{"type":"paragraph","inlineContent":[{"text":"Version 5.0 of the SDK introduces support for observer mode when making purchases with StoreKit 2. You can enable it when configuring the SDK:","type":"text"}]},{"code":["Purchases.configure(with: .builder(withAPIKey: apiKey)","\t\t.with(observerMode: true, storeKitVersion: .storeKit2)","    .build()"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"type":"text","text":"Additionally, because of the way in which StoreKit 2 operates, you must manually handle newly purchased transactions by calling "},{"type":"codeVoice","code":"Purchases.shared.handleObserverModeTransaction()"},{"text":". Subscription updates will be automatically tracked.","type":"text"}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["let result = try await product.purchase()","Purchases.shared.handleObserverModeTransaction(result)"]},{"inlineContent":[{"text":"If you‚Äôre using observer mode with StoreKit 1, you will need to explicitly configure the SDK to use StoreKit 1:","type":"text"}],"type":"paragraph"},{"code":["Purchases.configure(with: .builder(withAPIKey: apiKey)","\t\t.with(observerMode: true, storeKitVersion: .storeKit1)","    .build()"],"syntax":"swift","type":"codeListing"},{"level":3,"anchor":"Original-Application-Version","text":"Original Application Version","type":"heading"},{"inlineContent":[{"type":"text","text":"If you‚Äôre converting a paid app to in-app subscriptions, and want to provide existing customers with certain features, "},{"isActive":true,"type":"reference","identifier":"https:\/\/www.revenuecat.com\/blog\/engineering\/converting-a-paid-ios-app-to-subscriptions\/"},{"text":" using the ‚Äúoriginal app version‚Äù field in customer info.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Because of a limitation of StoreKit 2, this field is not available if the customer is running on iOS 15, tvOS 15, macOS 12 or watchOS 8. If this is a requirement for you, we recommend switching back to StoreKit 1."}]},{"level":2,"text":"Trusted Entitlements","type":"heading","anchor":"Trusted-Entitlements"},{"inlineContent":[{"text":"Version 5.0 of the SDK enables the Informational mode for Trusted Entitlements by default.","type":"text"},{"type":"text","text":" "},{"type":"text","text":"Informational mode logs verification errors and allow you to check "},{"code":"customerInfo.entitlements.verificationResult","type":"codeVoice"},{"text":" to protect your purchases from attackers.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"See the "},{"type":"reference","identifier":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements","isActive":true},{"text":" for more information.","type":"text"}],"type":"paragraph"},{"text":"Deployment Target","type":"heading","level":2,"anchor":"Deployment-Target"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The minimum targets have been raised to the folllowing:"}]},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"iOS 13.0"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"tvOS 13.0","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"watchOS 6.2","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"macOS 10.15"}]}]}]},{"type":"heading","level":2,"text":"Release Assets","anchor":"Release-Assets"},{"type":"paragraph","inlineContent":[{"text":"Pre-built ","type":"text"},{"type":"codeVoice","code":".frameworks"},{"type":"text","text":" are no longer included in releases, only "},{"type":"codeVoice","code":".xcframeworks"},{"text":": https:\/\/github.com\/RevenueCat\/purchases-ios\/pull\/3582","type":"text"}]}],"kind":"content"}],"variants":[{"paths":["\/documentation\/revenuecat\/v5_api_migration_guide"],"traits":[{"interfaceLanguage":"swift"}]}],"kind":"article","references":{"doc://RevenueCat/documentation/RevenueCat":{"identifier":"doc:\/\/RevenueCat\/documentation\/RevenueCat","title":"RevenueCat","kind":"symbol","abstract":[{"type":"text","text":"üòª In-App Subscriptions Made Easy üòª"}],"url":"\/documentation\/revenuecat","role":"collection","type":"topic"},"https://www.revenuecat.com/blog/engineering/converting-a-paid-ios-app-to-subscriptions/":{"type":"link","identifier":"https:\/\/www.revenuecat.com\/blog\/engineering\/converting-a-paid-ios-app-to-subscriptions\/","titleInlineContent":[{"text":"we recommend","type":"text"}],"url":"https:\/\/www.revenuecat.com\/blog\/engineering\/converting-a-paid-ios-app-to-subscriptions\/","title":"we recommend"},"https://www.revenuecat.com/integrations/":{"title":"data integrations","titleInlineContent":[{"type":"text","text":"data integrations"}],"identifier":"https:\/\/www.revenuecat.com\/integrations\/","url":"https:\/\/www.revenuecat.com\/integrations\/","type":"link"},"https://www.revenuecat.com/docs/trusted-entitlements":{"type":"link","identifier":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements","title":"Trusted Entitlements documentation","titleInlineContent":[{"text":"Trusted Entitlements documentation","type":"text"}],"url":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements"},"https://firebase.google.com/docs/analytics/measure-in-app-purchases#swift":{"identifier":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift","title":"these instructions","type":"link","titleInlineContent":[{"type":"text","text":"these instructions"}],"url":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift"},"https://www.revenuecat.com/docs/in-app-purchase-key-configuration":{"type":"link","identifier":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration","title":"In-App Purchase Key","titleInlineContent":[{"text":"In-App Purchase Key","type":"text"}],"url":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration"}}}