{"kind":"article","primaryContentSections":[{"content":[{"anchor":"StoreKit-2","type":"heading","text":"StoreKit 2","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"Version 5.0 of the RevenueCat SDK enables full StoreKit 2 flow on the SDK and the RevenueCat backend by default."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"We have been testing StoreKit 2 support in parallel to StoreKit 1 in our backend for a while and we believe it is ready for widespread use."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Here‚Äôs some of the benefits you get with StoreKit 2:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Better handling of a few specific edge cases which were unfixable with StoreKit 1:","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"No more ‚ÄúMissing receipt‚Äù errors in Sandbox that could result in failure restoring purchases or getting trial eligibility status ‚Äúunknown‚Äù.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"No more ‚ÄúThe purchased product was missing in the receipt‚Äù error that could cause an invalid receipt error when making a purchase."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Future proofing: StoreKit 1 APIs are being progressively deprecated by Apple, and new features are being added to StoreKit 2."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Faster processing time: More efficient and performant implementation of receipts validation. We have found that receipts validation can be ~200ms faster comparing to SK1 implementation for p95 of the requests.","type":"text"}]}]}]},{"inlineContent":[{"type":"text","text":"In order to use StoreKit 2, you will need to configure your "},{"type":"reference","identifier":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration","isActive":true},{"type":"text","text":" in the RevenueCat dashboard."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"The previously deprecated configuration option ","type":"text"},{"type":"codeVoice","code":".with(usesStoreKit2IfAvailable: true)"},{"type":"text","text":" has been removed. Remove it from your configuration option to continue using StoreKit 2."}]},{"type":"paragraph","inlineContent":[{"text":"The SDK will automatically use StoreKit 1 in the following versions where StoreKit 2 is not supported: on macOS 12 or earlier, iOS 15 or earlier, iPadOS 15 or earlier, tvOS 15 or earlier, or watchOS 8 or earlier.","type":"text"}]},{"inlineContent":[{"type":"text","text":"If for any reason you need to always use StoreKit 1, it is possible to switch back using the following configuration API:"}],"type":"paragraph"},{"code":["Purchases.configure(with: .builder(withAPIKey: apiKey)","  .with(storeKitVersion: .storeKit1)","  .build()"],"syntax":"swift","type":"codeListing"},{"anchor":"3rd-Party-Analytics-SDKs","text":"3rd Party Analytics SDKs","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you are using any 3rd party analytics SDKs to automatically track in-app purchases, you need to be aware most of them do not completely support logging purchases made with StoreKit 2. This is the case for some popular SDKs like Facebook, Mixpanel, OneSignal, Segment or Firebase. For these services, we recommend you use our "},{"isActive":true,"type":"reference","identifier":"https:\/\/www.revenuecat.com\/integrations\/"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"text":"If you‚Äôre using the Firebase SDK, you‚Äôll need to follow ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift"},{"type":"text","text":" to log purchases made with StoreKit 2."}]},{"level":3,"type":"heading","anchor":"Observer-Mode-is-now-PurchasesAreCompletedBy","text":"Observer Mode is now PurchasesAreCompletedBy"},{"inlineContent":[{"text":"Version 5.0 of the SDK  deprecates the term ‚ÄúObserver Mode‚Äù (and the APIs where this term was used), and replaces it","type":"text"},{"type":"text","text":" "},{"text":"with ","type":"text"},{"code":"PurchasesAreCompletedBy","type":"codeVoice"},{"text":" (either RevenueCat or your app).","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"Version 5.0 of the SDK also introduces support for recording purchases made directly by your app calling StoreKit 2.","type":"text"}]},{"inlineContent":[{"text":"You can enable it when configuring the SDK:","type":"text"}],"type":"paragraph"},{"rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Version 4"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Version 5"}]}]],[[{"type":"paragraph","inlineContent":[{"text":"Purchases.configure(with: .builder(withAPIKey: apiKey)","type":"text"},{"text":"  .with(observerMode: true)","type":"text"},{"type":"text","text":"  .build()"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Purchases.configure(with: .builder(withAPIKey: apiKey)"},{"type":"text","text":"  .with(purchasesAreCompletedBy: .myApp, storeKitVersion: .storeKit2)"},{"type":"text","text":"  .build()"}]}]]],"type":"table","header":"row"},{"type":"heading","anchor":"‚ö†Ô∏è-Observing-Purchases-Completed-by-Your-App-on-macOS","text":"‚ö†Ô∏è Observing Purchases Completed by Your App on macOS","level":4},{"inlineContent":[{"text":"By default, when purchases are completed by your app using StoreKit 2 on macOS, the SDK does not detect a user‚Äôs purchase until after the user foregrounds the app after the purchase has been made. If you‚Äôd like RevenueCat to immediately detect the user‚Äôs purchase, call ","type":"text"},{"code":"Purchases.shared.recordPurchase(purchaseResult)","type":"codeVoice"},{"type":"text","text":" for any new purchases, like so:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["let product = try await StoreKit.Product.products(for: [\"my_product_id\"]).first","let result = try await product?.purchase()","","_ = try await Purchases.shared.recordPurchase(result)"]},{"type":"heading","text":"Observing Purchases Completed by Your App with StoreKit 1","anchor":"Observing-Purchases-Completed-by-Your-App-with-StoreKit-1","level":4},{"inlineContent":[{"text":"If purchases are completed by your app using StoreKit 1, you will need to explicitly configure the SDK to use StoreKit 1:","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["Purchases.configure(with: .builder(withAPIKey: apiKey)","  .with(purchasesAreCompletedBy: .myApp, storeKitVersion: .storeKit1)","  .build()"],"type":"codeListing"},{"level":2,"anchor":"Trusted-Entitlements","text":"Trusted Entitlements","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Version 5.0 of the SDK enables the Informational mode for Trusted Entitlements by default.","type":"text"},{"text":" ","type":"text"},{"text":"Informational mode logs verification errors and allow you to check ","type":"text"},{"type":"codeVoice","code":"customerInfo.entitlements.verificationResult"},{"type":"text","text":" to protect your purchases from attackers."}]},{"inlineContent":[{"type":"text","text":"See the "},{"type":"reference","identifier":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements","isActive":true},{"text":" for more information.","type":"text"}],"type":"paragraph"},{"text":"Deployment Target","anchor":"Deployment-Target","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"The minimum targets have been raised to the following:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"iOS 13.0"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"tvOS 13.0"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"watchOS 6.2","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"macOS 10.15","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"anchor":"Release-Assets","text":"Release Assets","level":2,"type":"heading"},{"inlineContent":[{"type":"text","text":"Pre-built "},{"code":".frameworks","type":"codeVoice"},{"type":"text","text":" are no longer included in releases, only "},{"type":"codeVoice","code":".xcframeworks"},{"text":": https:\/\/github.com\/RevenueCat\/purchases-ios\/pull\/3582","type":"text"}],"type":"paragraph"},{"type":"heading","anchor":"Breaking-Changes","level":2,"text":"Breaking Changes"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The scope of the View extension ","type":"text"},{"code":"onChangeOf","type":"codeVoice"},{"text":" is changed from ","type":"text"},{"type":"codeVoice","code":"public"},{"type":"text","text":" to "},{"type":"codeVoice","code":"internal"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"This was never intended to be made public and to be used outside of the RevenueCat SDK","type":"text"}]}]}]}]}],"type":"unorderedList"}],"kind":"content"}],"sections":[],"schemaVersion":{"patch":0,"major":0,"minor":3},"hierarchy":{"paths":[["doc:\/\/RevenueCat\/documentation\/RevenueCat"]]},"metadata":{"title":"RevenueCat 4.x to 5.x Migration Guide","role":"article","modules":[{"name":"RevenueCat"}],"roleHeading":"Article"},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/RevenueCat\/documentation\/RevenueCat\/V5_API_Migration_guide"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/revenuecat\/v5_api_migration_guide"]}],"references":{"doc://RevenueCat/documentation/RevenueCat":{"title":"RevenueCat","role":"collection","abstract":[{"text":"üòª In-App Subscriptions Made Easy üòª","type":"text"}],"kind":"symbol","identifier":"doc:\/\/RevenueCat\/documentation\/RevenueCat","url":"\/documentation\/revenuecat","type":"topic"},"https://firebase.google.com/docs/analytics/measure-in-app-purchases#swift":{"type":"link","identifier":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift","title":"these instructions","url":"https:\/\/firebase.google.com\/docs\/analytics\/measure-in-app-purchases#swift","titleInlineContent":[{"type":"text","text":"these instructions"}]},"https://www.revenuecat.com/integrations/":{"type":"link","title":"data integrations","titleInlineContent":[{"type":"text","text":"data integrations"}],"url":"https:\/\/www.revenuecat.com\/integrations\/","identifier":"https:\/\/www.revenuecat.com\/integrations\/"},"https://www.revenuecat.com/docs/in-app-purchase-key-configuration":{"type":"link","identifier":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration","title":"In-App Purchase Key","url":"https:\/\/www.revenuecat.com\/docs\/in-app-purchase-key-configuration","titleInlineContent":[{"type":"text","text":"In-App Purchase Key"}]},"https://www.revenuecat.com/docs/trusted-entitlements":{"type":"link","title":"Trusted Entitlements documentation","titleInlineContent":[{"type":"text","text":"Trusted Entitlements documentation"}],"url":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements","identifier":"https:\/\/www.revenuecat.com\/docs\/trusted-entitlements"}}}